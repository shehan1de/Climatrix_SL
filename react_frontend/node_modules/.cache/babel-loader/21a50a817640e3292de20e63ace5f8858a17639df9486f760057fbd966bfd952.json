{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\HP\\\\Desktop\\\\Assignments\\\\Nadil\\\\Final\\\\Climatrix\\\\react_frontend\\\\src\\\\pages\\\\client\\\\PredictionHistory.js\",\n  _s = $RefreshSig$();\nimport axios from \"axios\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport logo from \"../../assets/logo.png\";\nimport Footer from \"../../components/Footer\";\nimport { FaDownload, FaChartBar, FaSyncAlt, FaTimes } from \"react-icons/fa\";\nimport jsPDF from \"jspdf\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PredictionHistory = () => {\n  _s();\n  const user = JSON.parse(localStorage.getItem(\"user\"));\n  const userId = user === null || user === void 0 ? void 0 : user.userId;\n  const [predictions, setPredictions] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [alert, setAlert] = useState({\n    type: \"\",\n    message: \"\"\n  });\n\n  // ✅ UI filters\n  const [search, setSearch] = useState(\"\");\n  const [timeframeFilter, setTimeframeFilter] = useState(\"all\");\n  const [riskFilter, setRiskFilter] = useState(\"all\");\n\n  // ✅ NEW: sort filter\n  const [sortOrder, setSortOrder] = useState(\"latest\"); // latest | oldest\n\n  // ✅ NEW: plot modal\n  const [showPlot, setShowPlot] = useState(false);\n  const [selectedPrediction, setSelectedPrediction] = useState(null);\n\n  // Alert timeout\n  useEffect(() => {\n    if (alert.message) {\n      const timer = setTimeout(() => setAlert({\n        type: \"\",\n        message: \"\"\n      }), 3000);\n      return () => clearTimeout(timer);\n    }\n  }, [alert]);\n\n  // Fetch user predictions\n  const fetchPredictions = async () => {\n    if (!userId) return;\n    setLoading(true);\n    try {\n      const res = await axios.get(`http://localhost:5001/api/predictions/user/${userId}`);\n\n      // Keep as received; sorting handled in UI\n      setPredictions(res.data || []);\n    } catch (err) {\n      console.error(err);\n      setAlert({\n        type: \"error\",\n        message: \"Failed to fetch prediction history\"\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    fetchPredictions();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [userId]);\n\n  // helper: pretty labels\n  const prettyParam = param => {\n    if (param === \"rain_sum\") return \"Rainfall\";\n    if (param === \"windspeed_10m_max\") return \"Wind Speed\";\n    if (param === \"windgusts_10m_max\") return \"Wind Gusts\";\n    return param; // already friendly on your backend (Rainfall / Wind Speed...)\n  };\n  const formatDateTime = iso => {\n    if (!iso) return \"—\";\n    const d = new Date(iso);\n    if (Number.isNaN(d.getTime())) return \"—\";\n    return d.toLocaleString();\n  };\n  const riskClass = riskText => `risk-${String(riskText || \"\").toLowerCase().replace(/\\s+/g, \"-\")}`; // \"Low Risk\" -> \"risk-low-risk\"\n\n  // ✅ Filter + sort list\n  const filtered = useMemo(() => {\n    const q = search.trim().toLowerCase();\n    const list = predictions.filter(p => {\n      const matchesSearch = !q || `${p.city} ${p.parameter} ${p.disaster_risk}`.toLowerCase().includes(q);\n      const matchesTimeframe = timeframeFilter === \"all\" || p.timeframe === timeframeFilter;\n      const matchesRisk = riskFilter === \"all\" || p.disaster_risk === riskFilter;\n      return matchesSearch && matchesTimeframe && matchesRisk;\n    });\n\n    // sort by createdAt\n    list.sort((a, b) => {\n      const da = new Date(a.createdAt || 0).getTime();\n      const db = new Date(b.createdAt || 0).getTime();\n      return sortOrder === \"latest\" ? db - da : da - db;\n    });\n    return list;\n  }, [predictions, search, timeframeFilter, riskFilter, sortOrder]);\n\n  // ✅ PDF download\n  const downloadPredictionPDF = p => {\n    try {\n      const doc = new jsPDF(\"p\", \"mm\", \"a4\");\n      const marginX = 14;\n      let y = 18;\n      doc.setFont(\"helvetica\", \"bold\");\n      doc.setFontSize(16);\n      doc.text(\"ClimatrixSL - Prediction Report\", marginX, y);\n      y += 10;\n      doc.setFont(\"helvetica\", \"normal\");\n      doc.setFontSize(11);\n      const lines = [`City: ${p.city}`, `Parameter: ${prettyParam(p.parameter)}`, `Timeframe: ${p.timeframe}`, `Mode: ${p.min_or_max}`, `Predicted Value: ${p.predicted_value}`, `Risk: ${p.disaster_risk}`, `Created At: ${formatDateTime(p.createdAt)}`];\n      lines.forEach(line => {\n        y += 7;\n        doc.text(line, marginX, y);\n      });\n      y += 10;\n      if (p.forecast_message) {\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.text(\"Message:\", marginX, y);\n        y += 7;\n        doc.setFont(\"helvetica\", \"normal\");\n        const msg = doc.splitTextToSize(p.forecast_message, 180);\n        doc.text(msg, marginX, y);\n        y += msg.length * 6 + 6;\n      }\n\n      // Add plot image if available\n      if (p.forecast_plot) {\n        const imgData = `data:image/png;base64,${p.forecast_plot}`;\n\n        // Keep a safe size to fit A4\n        const imgW = 180;\n        const imgH = 80;\n\n        // If near page end, add a new page\n        if (y + imgH > 280) {\n          doc.addPage();\n          y = 18;\n        }\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.text(\"Forecast Plot:\", marginX, y);\n        y += 6;\n        doc.addImage(imgData, \"PNG\", marginX, y, imgW, imgH);\n      }\n      const safeCity = String(p.city || \"prediction\").replace(/\\s+/g, \"_\");\n      doc.save(`Climatrix_${safeCity}_${Date.now()}.pdf`);\n    } catch (e) {\n      console.error(e);\n      setAlert({\n        type: \"error\",\n        message: \"PDF download failed. Make sure jspdf is installed.\"\n      });\n    }\n  };\n\n  // ✅ Plot modal open\n  const openPlotModal = p => {\n    setSelectedPrediction(p);\n    setShowPlot(true);\n  };\n\n  // ✅ Plot modal close\n  const closePlotModal = () => {\n    setShowPlot(false);\n    setSelectedPrediction(null);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"history-page d-flex flex-column\",\n    children: [alert.message && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `login-alert ${alert.type === \"error\" ? \"login-alert-error\" : \"login-alert-success\"}`,\n      children: alert.message\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 9\n    }, this), loading && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading-overlay\",\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        src: logo,\n        alt: \"Loading...\",\n        className: \"spinner-logo-large\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"history-container flex-grow-1\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"history-hero\",\n        children: /*#__PURE__*/_jsxDEV(\"h1\", {\n          className: \"history-title\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"brand-gradient\",\n            children: \"Prediction History\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 222,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"history-controls glass-panel\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"history-controls-row\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"form-control glass-input history-search\",\n            placeholder: \"Search by city, parameter, or risk...\",\n            value: search,\n            onChange: e => setSearch(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 229,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            className: \"form-control glass-input glass-select history-select\",\n            value: timeframeFilter,\n            onChange: e => setTimeframeFilter(e.target.value),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"all\",\n              children: \"All Timeframes\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"day\",\n              children: \"Day\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 242,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"week\",\n              children: \"Week\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 243,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"month\",\n              children: \"Month\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 244,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            className: \"form-control glass-input glass-select history-select\",\n            value: riskFilter,\n            onChange: e => setRiskFilter(e.target.value),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"all\",\n              children: \"All Risks\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"Low Risk\",\n              children: \"Low\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"Moderate Risk\",\n              children: \"Moderate\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"High Risk\",\n              children: \"High\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            className: \"form-control glass-input glass-select history-select\",\n            value: sortOrder,\n            onChange: e => setSortOrder(e.target.value),\n            title: \"Sort\",\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"latest\",\n              children: \"Latest\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 265,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"oldest\",\n              children: \"Oldest\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-outline-light history-refresh icon-btn\",\n            type: \"button\",\n            onClick: fetchPredictions,\n            title: \"Refresh\",\n            children: /*#__PURE__*/_jsxDEV(FaSyncAlt, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 275,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"history-count text-white-50\",\n          children: [\"Showing \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            className: \"text-white\",\n            children: filtered.length\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 280,\n            columnNumber: 21\n          }, this), \" \", \"results\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }, this), !loading && filtered.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"glass-panel history-empty text-center text-white\",\n        children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n          className: \"fw-bold mb-2\",\n          children: \"No predictions found\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-white-50 mb-0\",\n          children: \"Try changing filters or generate a new prediction.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"history-grid\",\n        children: filtered.map(p => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"history-card\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"history-card-top\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                className: \"history-card-title\",\n                children: [p.city, \" \\u2022 \", prettyParam(p.parameter)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 301,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"history-card-meta\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"chip\",\n                  children: p.timeframe\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 306,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"chip\",\n                  children: p.min_or_max\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 307,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"chip chip-strong\",\n                  children: [\"Value \", p.predicted_value]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 308,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"chip chip-date\",\n                  children: formatDateTime(p.createdAt)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 311,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 305,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `risk-pill ${riskClass(p.disaster_risk)}`,\n              children: p.disaster_risk\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 317,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 15\n          }, this), p.forecast_message && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"history-message\",\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Message\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 324,\n              columnNumber: 19\n            }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-white-50\",\n              children: p.forecast_message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 325,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"history-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"icon-action-btn\",\n              title: \"Download PDF\",\n              type: \"button\",\n              onClick: () => downloadPredictionPDF(p),\n              children: /*#__PURE__*/_jsxDEV(FaDownload, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 337,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 331,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"icon-action-btn\",\n              title: \"View Plot\",\n              type: \"button\",\n              disabled: !p.forecast_plot,\n              onClick: () => openPlotModal(p),\n              children: /*#__PURE__*/_jsxDEV(FaChartBar, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 347,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 340,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 330,\n            columnNumber: 15\n          }, this)]\n        }, p._id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }, this), showPlot && selectedPrediction && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"history-modal-overlay\",\n      onClick: closePlotModal,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"history-modal-glass\",\n        onClick: e => e.stopPropagation(),\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"history-modal-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"history-modal-title\",\n              children: [selectedPrediction.city, \" \\u2022\", \" \", prettyParam(selectedPrediction.parameter)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 364,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"history-modal-sub text-white-50\",\n              children: formatDateTime(selectedPrediction.createdAt)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 368,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"history-modal-close\",\n            type: \"button\",\n            onClick: closePlotModal,\n            title: \"Close\",\n            children: /*#__PURE__*/_jsxDEV(FaTimes, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 379,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"history-modal-body\",\n          children: selectedPrediction.forecast_plot ? /*#__PURE__*/_jsxDEV(\"img\", {\n            src: `data:image/png;base64,${selectedPrediction.forecast_plot}`,\n            alt: \"Forecast Plot\",\n            className: \"history-modal-plot\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 385,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-white-50 text-center\",\n            children: \"No plot available for this prediction.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 391,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 383,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 198,\n    columnNumber: 5\n  }, this);\n};\n_s(PredictionHistory, \"l5kBTNihzLx+R/ShtdHaWkmG1ec=\");\n_c = PredictionHistory;\nexport default PredictionHistory;\nvar _c;\n$RefreshReg$(_c, \"PredictionHistory\");","map":{"version":3,"names":["axios","useEffect","useMemo","useState","logo","Footer","FaDownload","FaChartBar","FaSyncAlt","FaTimes","jsPDF","jsxDEV","_jsxDEV","PredictionHistory","_s","user","JSON","parse","localStorage","getItem","userId","predictions","setPredictions","loading","setLoading","alert","setAlert","type","message","search","setSearch","timeframeFilter","setTimeframeFilter","riskFilter","setRiskFilter","sortOrder","setSortOrder","showPlot","setShowPlot","selectedPrediction","setSelectedPrediction","timer","setTimeout","clearTimeout","fetchPredictions","res","get","data","err","console","error","prettyParam","param","formatDateTime","iso","d","Date","Number","isNaN","getTime","toLocaleString","riskClass","riskText","String","toLowerCase","replace","filtered","q","trim","list","filter","p","matchesSearch","city","parameter","disaster_risk","includes","matchesTimeframe","timeframe","matchesRisk","sort","a","b","da","createdAt","db","downloadPredictionPDF","doc","marginX","y","setFont","setFontSize","text","lines","min_or_max","predicted_value","forEach","line","forecast_message","msg","splitTextToSize","length","forecast_plot","imgData","imgW","imgH","addPage","addImage","safeCity","save","now","e","openPlotModal","closePlotModal","className","children","fileName","_jsxFileName","lineNumber","columnNumber","src","alt","placeholder","value","onChange","target","title","onClick","map","disabled","_id","stopPropagation","_c","$RefreshReg$"],"sources":["C:/Users/HP/Desktop/Assignments/Nadil/Final/Climatrix/react_frontend/src/pages/client/PredictionHistory.js"],"sourcesContent":["import axios from \"axios\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport logo from \"../../assets/logo.png\";\nimport Footer from \"../../components/Footer\";\nimport { FaDownload, FaChartBar, FaSyncAlt, FaTimes } from \"react-icons/fa\";\nimport jsPDF from \"jspdf\";\n\nconst PredictionHistory = () => {\n  const user = JSON.parse(localStorage.getItem(\"user\"));\n  const userId = user?.userId;\n\n  const [predictions, setPredictions] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [alert, setAlert] = useState({ type: \"\", message: \"\" });\n\n  // ✅ UI filters\n  const [search, setSearch] = useState(\"\");\n  const [timeframeFilter, setTimeframeFilter] = useState(\"all\");\n  const [riskFilter, setRiskFilter] = useState(\"all\");\n\n  // ✅ NEW: sort filter\n  const [sortOrder, setSortOrder] = useState(\"latest\"); // latest | oldest\n\n  // ✅ NEW: plot modal\n  const [showPlot, setShowPlot] = useState(false);\n  const [selectedPrediction, setSelectedPrediction] = useState(null);\n\n  // Alert timeout\n  useEffect(() => {\n    if (alert.message) {\n      const timer = setTimeout(() => setAlert({ type: \"\", message: \"\" }), 3000);\n      return () => clearTimeout(timer);\n    }\n  }, [alert]);\n\n  // Fetch user predictions\n  const fetchPredictions = async () => {\n    if (!userId) return;\n    setLoading(true);\n\n    try {\n      const res = await axios.get(\n        `http://localhost:5001/api/predictions/user/${userId}`\n      );\n\n      // Keep as received; sorting handled in UI\n      setPredictions(res.data || []);\n    } catch (err) {\n      console.error(err);\n      setAlert({ type: \"error\", message: \"Failed to fetch prediction history\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchPredictions();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [userId]);\n\n  // helper: pretty labels\n  const prettyParam = (param) => {\n    if (param === \"rain_sum\") return \"Rainfall\";\n    if (param === \"windspeed_10m_max\") return \"Wind Speed\";\n    if (param === \"windgusts_10m_max\") return \"Wind Gusts\";\n    return param; // already friendly on your backend (Rainfall / Wind Speed...)\n  };\n\n  const formatDateTime = (iso) => {\n    if (!iso) return \"—\";\n    const d = new Date(iso);\n    if (Number.isNaN(d.getTime())) return \"—\";\n    return d.toLocaleString();\n  };\n\n  const riskClass = (riskText) =>\n    `risk-${String(riskText || \"\")\n      .toLowerCase()\n      .replace(/\\s+/g, \"-\")}`; // \"Low Risk\" -> \"risk-low-risk\"\n\n  // ✅ Filter + sort list\n  const filtered = useMemo(() => {\n    const q = search.trim().toLowerCase();\n\n    const list = predictions.filter((p) => {\n      const matchesSearch =\n        !q ||\n        `${p.city} ${p.parameter} ${p.disaster_risk}`\n          .toLowerCase()\n          .includes(q);\n\n      const matchesTimeframe =\n        timeframeFilter === \"all\" || p.timeframe === timeframeFilter;\n\n      const matchesRisk =\n        riskFilter === \"all\" || p.disaster_risk === riskFilter;\n\n      return matchesSearch && matchesTimeframe && matchesRisk;\n    });\n\n    // sort by createdAt\n    list.sort((a, b) => {\n      const da = new Date(a.createdAt || 0).getTime();\n      const db = new Date(b.createdAt || 0).getTime();\n      return sortOrder === \"latest\" ? db - da : da - db;\n    });\n\n    return list;\n  }, [predictions, search, timeframeFilter, riskFilter, sortOrder]);\n\n  // ✅ PDF download\n  const downloadPredictionPDF = (p) => {\n    try {\n      const doc = new jsPDF(\"p\", \"mm\", \"a4\");\n      const marginX = 14;\n      let y = 18;\n\n      doc.setFont(\"helvetica\", \"bold\");\n      doc.setFontSize(16);\n      doc.text(\"ClimatrixSL - Prediction Report\", marginX, y);\n\n      y += 10;\n      doc.setFont(\"helvetica\", \"normal\");\n      doc.setFontSize(11);\n\n      const lines = [\n        `City: ${p.city}`,\n        `Parameter: ${prettyParam(p.parameter)}`,\n        `Timeframe: ${p.timeframe}`,\n        `Mode: ${p.min_or_max}`,\n        `Predicted Value: ${p.predicted_value}`,\n        `Risk: ${p.disaster_risk}`,\n        `Created At: ${formatDateTime(p.createdAt)}`\n      ];\n\n      lines.forEach((line) => {\n        y += 7;\n        doc.text(line, marginX, y);\n      });\n\n      y += 10;\n      if (p.forecast_message) {\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.text(\"Message:\", marginX, y);\n        y += 7;\n\n        doc.setFont(\"helvetica\", \"normal\");\n        const msg = doc.splitTextToSize(p.forecast_message, 180);\n        doc.text(msg, marginX, y);\n        y += msg.length * 6 + 6;\n      }\n\n      // Add plot image if available\n      if (p.forecast_plot) {\n        const imgData = `data:image/png;base64,${p.forecast_plot}`;\n\n        // Keep a safe size to fit A4\n        const imgW = 180;\n        const imgH = 80;\n\n        // If near page end, add a new page\n        if (y + imgH > 280) {\n          doc.addPage();\n          y = 18;\n        }\n\n        doc.setFont(\"helvetica\", \"bold\");\n        doc.text(\"Forecast Plot:\", marginX, y);\n        y += 6;\n\n        doc.addImage(imgData, \"PNG\", marginX, y, imgW, imgH);\n      }\n\n      const safeCity = String(p.city || \"prediction\").replace(/\\s+/g, \"_\");\n      doc.save(`Climatrix_${safeCity}_${Date.now()}.pdf`);\n    } catch (e) {\n      console.error(e);\n      setAlert({\n        type: \"error\",\n        message: \"PDF download failed. Make sure jspdf is installed.\"\n      });\n    }\n  };\n\n  // ✅ Plot modal open\n  const openPlotModal = (p) => {\n    setSelectedPrediction(p);\n    setShowPlot(true);\n  };\n\n  // ✅ Plot modal close\n  const closePlotModal = () => {\n    setShowPlot(false);\n    setSelectedPrediction(null);\n  };\n\n  return (\n    <div className=\"history-page d-flex flex-column\">\n      {/* Alerts */}\n      {alert.message && (\n        <div\n          className={`login-alert ${\n            alert.type === \"error\" ? \"login-alert-error\" : \"login-alert-success\"\n          }`}\n        >\n          {alert.message}\n        </div>\n      )}\n\n      {/* Loading */}\n      {loading && (\n        <div className=\"loading-overlay\">\n          <img src={logo} alt=\"Loading...\" className=\"spinner-logo-large\" />\n        </div>\n      )}\n\n      {/* Content */}\n      <div className=\"history-container flex-grow-1\">\n        {/* Header */}\n        <div className=\"history-hero\">\n          <h1 className=\"history-title\">\n            <span className=\"brand-gradient\">Prediction History</span>\n          </h1>\n        </div>\n\n        {/* Controls */}\n        <div className=\"history-controls glass-panel\">\n          <div className=\"history-controls-row\">\n            <input\n              className=\"form-control glass-input history-search\"\n              placeholder=\"Search by city, parameter, or risk...\"\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n            />\n\n            <select\n              className=\"form-control glass-input glass-select history-select\"\n              value={timeframeFilter}\n              onChange={(e) => setTimeframeFilter(e.target.value)}\n            >\n              <option value=\"all\">All Timeframes</option>\n              <option value=\"day\">Day</option>\n              <option value=\"week\">Week</option>\n              <option value=\"month\">Month</option>\n            </select>\n\n            <select\n              className=\"form-control glass-input glass-select history-select\"\n              value={riskFilter}\n              onChange={(e) => setRiskFilter(e.target.value)}\n            >\n              <option value=\"all\">All Risks</option>\n              <option value=\"Low Risk\">Low</option>\n              <option value=\"Moderate Risk\">Moderate</option>\n              <option value=\"High Risk\">High</option>\n            </select>\n\n            {/* ✅ NEW sort */}\n            <select\n              className=\"form-control glass-input glass-select history-select\"\n              value={sortOrder}\n              onChange={(e) => setSortOrder(e.target.value)}\n              title=\"Sort\"\n            >\n              <option value=\"latest\">Latest</option>\n              <option value=\"oldest\">Oldest</option>\n            </select>\n\n            <button\n              className=\"btn btn-outline-light history-refresh icon-btn\"\n              type=\"button\"\n              onClick={fetchPredictions}\n              title=\"Refresh\"\n            >\n              <FaSyncAlt />\n            </button>\n          </div>\n\n          <div className=\"history-count text-white-50\">\n            Showing <strong className=\"text-white\">{filtered.length}</strong>{\" \"}\n            results\n          </div>\n        </div>\n\n        {/* Empty state */}\n        {!loading && filtered.length === 0 && (\n          <div className=\"glass-panel history-empty text-center text-white\">\n            <h5 className=\"fw-bold mb-2\">No predictions found</h5>\n            <p className=\"text-white-50 mb-0\">\n              Try changing filters or generate a new prediction.\n            </p>\n          </div>\n        )}\n\n        {/* Cards */}\n        <div className=\"history-grid\">\n          {filtered.map((p) => (\n            <div key={p._id} className=\"history-card\">\n              <div className=\"history-card-top\">\n                <div>\n                  <h5 className=\"history-card-title\">\n                    {p.city} • {prettyParam(p.parameter)}\n                  </h5>\n\n                  <div className=\"history-card-meta\">\n                    <span className=\"chip\">{p.timeframe}</span>\n                    <span className=\"chip\">{p.min_or_max}</span>\n                    <span className=\"chip chip-strong\">\n                      Value {p.predicted_value}\n                    </span>\n                    <span className=\"chip chip-date\">\n                      {formatDateTime(p.createdAt)}\n                    </span>\n                  </div>\n                </div>\n\n                <span className={`risk-pill ${riskClass(p.disaster_risk)}`}>\n                  {p.disaster_risk}\n                </span>\n              </div>\n\n              {p.forecast_message && (\n                <p className=\"history-message\">\n                  <strong>Message</strong>{\" \"}\n                  <span className=\"text-white-50\">{p.forecast_message}</span>\n                </p>\n              )}\n\n              {/* ✅ ICON ACTIONS */}\n              <div className=\"history-actions\">\n                <button\n                  className=\"icon-action-btn\"\n                  title=\"Download PDF\"\n                  type=\"button\"\n                  onClick={() => downloadPredictionPDF(p)}\n                >\n                  <FaDownload />\n                </button>\n\n                <button\n                  className=\"icon-action-btn\"\n                  title=\"View Plot\"\n                  type=\"button\"\n                  disabled={!p.forecast_plot}\n                  onClick={() => openPlotModal(p)}\n                >\n                  <FaChartBar />\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* ✅ PLOT MODAL (GLASS) */}\n      {showPlot && selectedPrediction && (\n        <div className=\"history-modal-overlay\" onClick={closePlotModal}>\n          <div\n            className=\"history-modal-glass\"\n            onClick={(e) => e.stopPropagation()}\n          >\n            <div className=\"history-modal-header\">\n              <div>\n                <div className=\"history-modal-title\">\n                  {selectedPrediction.city} •{\" \"}\n                  {prettyParam(selectedPrediction.parameter)}\n                </div>\n                <div className=\"history-modal-sub text-white-50\">\n                  {formatDateTime(selectedPrediction.createdAt)}\n                </div>\n              </div>\n\n              <button\n                className=\"history-modal-close\"\n                type=\"button\"\n                onClick={closePlotModal}\n                title=\"Close\"\n              >\n                <FaTimes />\n              </button>\n            </div>\n\n            <div className=\"history-modal-body\">\n              {selectedPrediction.forecast_plot ? (\n                <img\n                  src={`data:image/png;base64,${selectedPrediction.forecast_plot}`}\n                  alt=\"Forecast Plot\"\n                  className=\"history-modal-plot\"\n                />\n              ) : (\n                <div className=\"text-white-50 text-center\">\n                  No plot available for this prediction.\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      <Footer />\n    </div>\n  );\n};\n\nexport default PredictionHistory;"],"mappings":";;AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,SAAS,EAAEC,OAAO,EAAEC,QAAQ,QAAQ,OAAO;AACpD,OAAOC,IAAI,MAAM,uBAAuB;AACxC,OAAOC,MAAM,MAAM,yBAAyB;AAC5C,SAASC,UAAU,EAAEC,UAAU,EAAEC,SAAS,EAAEC,OAAO,QAAQ,gBAAgB;AAC3E,OAAOC,KAAK,MAAM,OAAO;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE1B,MAAMC,iBAAiB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC9B,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC;EACrD,MAAMC,MAAM,GAAGL,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEK,MAAM;EAE3B,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGnB,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACoB,OAAO,EAAEC,UAAU,CAAC,GAAGrB,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAACsB,KAAK,EAAEC,QAAQ,CAAC,GAAGvB,QAAQ,CAAC;IAAEwB,IAAI,EAAE,EAAE;IAAEC,OAAO,EAAE;EAAG,CAAC,CAAC;;EAE7D;EACA,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAG3B,QAAQ,CAAC,EAAE,CAAC;EACxC,MAAM,CAAC4B,eAAe,EAAEC,kBAAkB,CAAC,GAAG7B,QAAQ,CAAC,KAAK,CAAC;EAC7D,MAAM,CAAC8B,UAAU,EAAEC,aAAa,CAAC,GAAG/B,QAAQ,CAAC,KAAK,CAAC;;EAEnD;EACA,MAAM,CAACgC,SAAS,EAAEC,YAAY,CAAC,GAAGjC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC;;EAEtD;EACA,MAAM,CAACkC,QAAQ,EAAEC,WAAW,CAAC,GAAGnC,QAAQ,CAAC,KAAK,CAAC;EAC/C,MAAM,CAACoC,kBAAkB,EAAEC,qBAAqB,CAAC,GAAGrC,QAAQ,CAAC,IAAI,CAAC;;EAElE;EACAF,SAAS,CAAC,MAAM;IACd,IAAIwB,KAAK,CAACG,OAAO,EAAE;MACjB,MAAMa,KAAK,GAAGC,UAAU,CAAC,MAAMhB,QAAQ,CAAC;QAAEC,IAAI,EAAE,EAAE;QAAEC,OAAO,EAAE;MAAG,CAAC,CAAC,EAAE,IAAI,CAAC;MACzE,OAAO,MAAMe,YAAY,CAACF,KAAK,CAAC;IAClC;EACF,CAAC,EAAE,CAAChB,KAAK,CAAC,CAAC;;EAEX;EACA,MAAMmB,gBAAgB,GAAG,MAAAA,CAAA,KAAY;IACnC,IAAI,CAACxB,MAAM,EAAE;IACbI,UAAU,CAAC,IAAI,CAAC;IAEhB,IAAI;MACF,MAAMqB,GAAG,GAAG,MAAM7C,KAAK,CAAC8C,GAAG,CACzB,8CAA8C1B,MAAM,EACtD,CAAC;;MAED;MACAE,cAAc,CAACuB,GAAG,CAACE,IAAI,IAAI,EAAE,CAAC;IAChC,CAAC,CAAC,OAAOC,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAACF,GAAG,CAAC;MAClBtB,QAAQ,CAAC;QAAEC,IAAI,EAAE,OAAO;QAAEC,OAAO,EAAE;MAAqC,CAAC,CAAC;IAC5E,CAAC,SAAS;MACRJ,UAAU,CAAC,KAAK,CAAC;IACnB;EACF,CAAC;EAEDvB,SAAS,CAAC,MAAM;IACd2C,gBAAgB,CAAC,CAAC;IAClB;EACF,CAAC,EAAE,CAACxB,MAAM,CAAC,CAAC;;EAEZ;EACA,MAAM+B,WAAW,GAAIC,KAAK,IAAK;IAC7B,IAAIA,KAAK,KAAK,UAAU,EAAE,OAAO,UAAU;IAC3C,IAAIA,KAAK,KAAK,mBAAmB,EAAE,OAAO,YAAY;IACtD,IAAIA,KAAK,KAAK,mBAAmB,EAAE,OAAO,YAAY;IACtD,OAAOA,KAAK,CAAC,CAAC;EAChB,CAAC;EAED,MAAMC,cAAc,GAAIC,GAAG,IAAK;IAC9B,IAAI,CAACA,GAAG,EAAE,OAAO,GAAG;IACpB,MAAMC,CAAC,GAAG,IAAIC,IAAI,CAACF,GAAG,CAAC;IACvB,IAAIG,MAAM,CAACC,KAAK,CAACH,CAAC,CAACI,OAAO,CAAC,CAAC,CAAC,EAAE,OAAO,GAAG;IACzC,OAAOJ,CAAC,CAACK,cAAc,CAAC,CAAC;EAC3B,CAAC;EAED,MAAMC,SAAS,GAAIC,QAAQ,IACzB,QAAQC,MAAM,CAACD,QAAQ,IAAI,EAAE,CAAC,CAC3BE,WAAW,CAAC,CAAC,CACbC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC;;EAE7B;EACA,MAAMC,QAAQ,GAAGhE,OAAO,CAAC,MAAM;IAC7B,MAAMiE,CAAC,GAAGtC,MAAM,CAACuC,IAAI,CAAC,CAAC,CAACJ,WAAW,CAAC,CAAC;IAErC,MAAMK,IAAI,GAAGhD,WAAW,CAACiD,MAAM,CAAEC,CAAC,IAAK;MACrC,MAAMC,aAAa,GACjB,CAACL,CAAC,IACF,GAAGI,CAAC,CAACE,IAAI,IAAIF,CAAC,CAACG,SAAS,IAAIH,CAAC,CAACI,aAAa,EAAE,CAC1CX,WAAW,CAAC,CAAC,CACbY,QAAQ,CAACT,CAAC,CAAC;MAEhB,MAAMU,gBAAgB,GACpB9C,eAAe,KAAK,KAAK,IAAIwC,CAAC,CAACO,SAAS,KAAK/C,eAAe;MAE9D,MAAMgD,WAAW,GACf9C,UAAU,KAAK,KAAK,IAAIsC,CAAC,CAACI,aAAa,KAAK1C,UAAU;MAExD,OAAOuC,aAAa,IAAIK,gBAAgB,IAAIE,WAAW;IACzD,CAAC,CAAC;;IAEF;IACAV,IAAI,CAACW,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;MAClB,MAAMC,EAAE,GAAG,IAAI3B,IAAI,CAACyB,CAAC,CAACG,SAAS,IAAI,CAAC,CAAC,CAACzB,OAAO,CAAC,CAAC;MAC/C,MAAM0B,EAAE,GAAG,IAAI7B,IAAI,CAAC0B,CAAC,CAACE,SAAS,IAAI,CAAC,CAAC,CAACzB,OAAO,CAAC,CAAC;MAC/C,OAAOxB,SAAS,KAAK,QAAQ,GAAGkD,EAAE,GAAGF,EAAE,GAAGA,EAAE,GAAGE,EAAE;IACnD,CAAC,CAAC;IAEF,OAAOhB,IAAI;EACb,CAAC,EAAE,CAAChD,WAAW,EAAEQ,MAAM,EAAEE,eAAe,EAAEE,UAAU,EAAEE,SAAS,CAAC,CAAC;;EAEjE;EACA,MAAMmD,qBAAqB,GAAIf,CAAC,IAAK;IACnC,IAAI;MACF,MAAMgB,GAAG,GAAG,IAAI7E,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC;MACtC,MAAM8E,OAAO,GAAG,EAAE;MAClB,IAAIC,CAAC,GAAG,EAAE;MAEVF,GAAG,CAACG,OAAO,CAAC,WAAW,EAAE,MAAM,CAAC;MAChCH,GAAG,CAACI,WAAW,CAAC,EAAE,CAAC;MACnBJ,GAAG,CAACK,IAAI,CAAC,iCAAiC,EAAEJ,OAAO,EAAEC,CAAC,CAAC;MAEvDA,CAAC,IAAI,EAAE;MACPF,GAAG,CAACG,OAAO,CAAC,WAAW,EAAE,QAAQ,CAAC;MAClCH,GAAG,CAACI,WAAW,CAAC,EAAE,CAAC;MAEnB,MAAME,KAAK,GAAG,CACZ,SAAStB,CAAC,CAACE,IAAI,EAAE,EACjB,cAActB,WAAW,CAACoB,CAAC,CAACG,SAAS,CAAC,EAAE,EACxC,cAAcH,CAAC,CAACO,SAAS,EAAE,EAC3B,SAASP,CAAC,CAACuB,UAAU,EAAE,EACvB,oBAAoBvB,CAAC,CAACwB,eAAe,EAAE,EACvC,SAASxB,CAAC,CAACI,aAAa,EAAE,EAC1B,eAAetB,cAAc,CAACkB,CAAC,CAACa,SAAS,CAAC,EAAE,CAC7C;MAEDS,KAAK,CAACG,OAAO,CAAEC,IAAI,IAAK;QACtBR,CAAC,IAAI,CAAC;QACNF,GAAG,CAACK,IAAI,CAACK,IAAI,EAAET,OAAO,EAAEC,CAAC,CAAC;MAC5B,CAAC,CAAC;MAEFA,CAAC,IAAI,EAAE;MACP,IAAIlB,CAAC,CAAC2B,gBAAgB,EAAE;QACtBX,GAAG,CAACG,OAAO,CAAC,WAAW,EAAE,MAAM,CAAC;QAChCH,GAAG,CAACK,IAAI,CAAC,UAAU,EAAEJ,OAAO,EAAEC,CAAC,CAAC;QAChCA,CAAC,IAAI,CAAC;QAENF,GAAG,CAACG,OAAO,CAAC,WAAW,EAAE,QAAQ,CAAC;QAClC,MAAMS,GAAG,GAAGZ,GAAG,CAACa,eAAe,CAAC7B,CAAC,CAAC2B,gBAAgB,EAAE,GAAG,CAAC;QACxDX,GAAG,CAACK,IAAI,CAACO,GAAG,EAAEX,OAAO,EAAEC,CAAC,CAAC;QACzBA,CAAC,IAAIU,GAAG,CAACE,MAAM,GAAG,CAAC,GAAG,CAAC;MACzB;;MAEA;MACA,IAAI9B,CAAC,CAAC+B,aAAa,EAAE;QACnB,MAAMC,OAAO,GAAG,yBAAyBhC,CAAC,CAAC+B,aAAa,EAAE;;QAE1D;QACA,MAAME,IAAI,GAAG,GAAG;QAChB,MAAMC,IAAI,GAAG,EAAE;;QAEf;QACA,IAAIhB,CAAC,GAAGgB,IAAI,GAAG,GAAG,EAAE;UAClBlB,GAAG,CAACmB,OAAO,CAAC,CAAC;UACbjB,CAAC,GAAG,EAAE;QACR;QAEAF,GAAG,CAACG,OAAO,CAAC,WAAW,EAAE,MAAM,CAAC;QAChCH,GAAG,CAACK,IAAI,CAAC,gBAAgB,EAAEJ,OAAO,EAAEC,CAAC,CAAC;QACtCA,CAAC,IAAI,CAAC;QAENF,GAAG,CAACoB,QAAQ,CAACJ,OAAO,EAAE,KAAK,EAAEf,OAAO,EAAEC,CAAC,EAAEe,IAAI,EAAEC,IAAI,CAAC;MACtD;MAEA,MAAMG,QAAQ,GAAG7C,MAAM,CAACQ,CAAC,CAACE,IAAI,IAAI,YAAY,CAAC,CAACR,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC;MACpEsB,GAAG,CAACsB,IAAI,CAAC,aAAaD,QAAQ,IAAIpD,IAAI,CAACsD,GAAG,CAAC,CAAC,MAAM,CAAC;IACrD,CAAC,CAAC,OAAOC,CAAC,EAAE;MACV9D,OAAO,CAACC,KAAK,CAAC6D,CAAC,CAAC;MAChBrF,QAAQ,CAAC;QACPC,IAAI,EAAE,OAAO;QACbC,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;EACF,CAAC;;EAED;EACA,MAAMoF,aAAa,GAAIzC,CAAC,IAAK;IAC3B/B,qBAAqB,CAAC+B,CAAC,CAAC;IACxBjC,WAAW,CAAC,IAAI,CAAC;EACnB,CAAC;;EAED;EACA,MAAM2E,cAAc,GAAGA,CAAA,KAAM;IAC3B3E,WAAW,CAAC,KAAK,CAAC;IAClBE,qBAAqB,CAAC,IAAI,CAAC;EAC7B,CAAC;EAED,oBACE5B,OAAA;IAAKsG,SAAS,EAAC,iCAAiC;IAAAC,QAAA,GAE7C1F,KAAK,CAACG,OAAO,iBACZhB,OAAA;MACEsG,SAAS,EAAE,eACTzF,KAAK,CAACE,IAAI,KAAK,OAAO,GAAG,mBAAmB,GAAG,qBAAqB,EACnE;MAAAwF,QAAA,EAEF1F,KAAK,CAACG;IAAO;MAAAwF,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACX,CACN,EAGAhG,OAAO,iBACNX,OAAA;MAAKsG,SAAS,EAAC,iBAAiB;MAAAC,QAAA,eAC9BvG,OAAA;QAAK4G,GAAG,EAAEpH,IAAK;QAACqH,GAAG,EAAC,YAAY;QAACP,SAAS,EAAC;MAAoB;QAAAE,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC/D,CACN,eAGD3G,OAAA;MAAKsG,SAAS,EAAC,+BAA+B;MAAAC,QAAA,gBAE5CvG,OAAA;QAAKsG,SAAS,EAAC,cAAc;QAAAC,QAAA,eAC3BvG,OAAA;UAAIsG,SAAS,EAAC,eAAe;UAAAC,QAAA,eAC3BvG,OAAA;YAAMsG,SAAS,EAAC,gBAAgB;YAAAC,QAAA,EAAC;UAAkB;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACxD;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACF,CAAC,eAGN3G,OAAA;QAAKsG,SAAS,EAAC,8BAA8B;QAAAC,QAAA,gBAC3CvG,OAAA;UAAKsG,SAAS,EAAC,sBAAsB;UAAAC,QAAA,gBACnCvG,OAAA;YACEsG,SAAS,EAAC,yCAAyC;YACnDQ,WAAW,EAAC,uCAAuC;YACnDC,KAAK,EAAE9F,MAAO;YACd+F,QAAQ,EAAGb,CAAC,IAAKjF,SAAS,CAACiF,CAAC,CAACc,MAAM,CAACF,KAAK;UAAE;YAAAP,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC5C,CAAC,eAEF3G,OAAA;YACEsG,SAAS,EAAC,sDAAsD;YAChES,KAAK,EAAE5F,eAAgB;YACvB6F,QAAQ,EAAGb,CAAC,IAAK/E,kBAAkB,CAAC+E,CAAC,CAACc,MAAM,CAACF,KAAK,CAAE;YAAAR,QAAA,gBAEpDvG,OAAA;cAAQ+G,KAAK,EAAC,KAAK;cAAAR,QAAA,EAAC;YAAc;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,eAC3C3G,OAAA;cAAQ+G,KAAK,EAAC,KAAK;cAAAR,QAAA,EAAC;YAAG;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,eAChC3G,OAAA;cAAQ+G,KAAK,EAAC,MAAM;cAAAR,QAAA,EAAC;YAAI;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,eAClC3G,OAAA;cAAQ+G,KAAK,EAAC,OAAO;cAAAR,QAAA,EAAC;YAAK;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC9B,CAAC,eAET3G,OAAA;YACEsG,SAAS,EAAC,sDAAsD;YAChES,KAAK,EAAE1F,UAAW;YAClB2F,QAAQ,EAAGb,CAAC,IAAK7E,aAAa,CAAC6E,CAAC,CAACc,MAAM,CAACF,KAAK,CAAE;YAAAR,QAAA,gBAE/CvG,OAAA;cAAQ+G,KAAK,EAAC,KAAK;cAAAR,QAAA,EAAC;YAAS;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,eACtC3G,OAAA;cAAQ+G,KAAK,EAAC,UAAU;cAAAR,QAAA,EAAC;YAAG;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,eACrC3G,OAAA;cAAQ+G,KAAK,EAAC,eAAe;cAAAR,QAAA,EAAC;YAAQ;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,eAC/C3G,OAAA;cAAQ+G,KAAK,EAAC,WAAW;cAAAR,QAAA,EAAC;YAAI;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACjC,CAAC,eAGT3G,OAAA;YACEsG,SAAS,EAAC,sDAAsD;YAChES,KAAK,EAAExF,SAAU;YACjByF,QAAQ,EAAGb,CAAC,IAAK3E,YAAY,CAAC2E,CAAC,CAACc,MAAM,CAACF,KAAK,CAAE;YAC9CG,KAAK,EAAC,MAAM;YAAAX,QAAA,gBAEZvG,OAAA;cAAQ+G,KAAK,EAAC,QAAQ;cAAAR,QAAA,EAAC;YAAM;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,eACtC3G,OAAA;cAAQ+G,KAAK,EAAC,QAAQ;cAAAR,QAAA,EAAC;YAAM;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAChC,CAAC,eAET3G,OAAA;YACEsG,SAAS,EAAC,gDAAgD;YAC1DvF,IAAI,EAAC,QAAQ;YACboG,OAAO,EAAEnF,gBAAiB;YAC1BkF,KAAK,EAAC,SAAS;YAAAX,QAAA,eAEfvG,OAAA,CAACJ,SAAS;cAAA4G,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACP,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC,eAEN3G,OAAA;UAAKsG,SAAS,EAAC,6BAA6B;UAAAC,QAAA,GAAC,UACnC,eAAAvG,OAAA;YAAQsG,SAAS,EAAC,YAAY;YAAAC,QAAA,EAAEjD,QAAQ,CAACmC;UAAM;YAAAe,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAS,CAAC,EAAC,GAAG,EAAC,SAExE;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,EAGL,CAAChG,OAAO,IAAI2C,QAAQ,CAACmC,MAAM,KAAK,CAAC,iBAChCzF,OAAA;QAAKsG,SAAS,EAAC,kDAAkD;QAAAC,QAAA,gBAC/DvG,OAAA;UAAIsG,SAAS,EAAC,cAAc;UAAAC,QAAA,EAAC;QAAoB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eACtD3G,OAAA;UAAGsG,SAAS,EAAC,oBAAoB;UAAAC,QAAA,EAAC;QAElC;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACD,CACN,eAGD3G,OAAA;QAAKsG,SAAS,EAAC,cAAc;QAAAC,QAAA,EAC1BjD,QAAQ,CAAC8D,GAAG,CAAEzD,CAAC,iBACd3D,OAAA;UAAiBsG,SAAS,EAAC,cAAc;UAAAC,QAAA,gBACvCvG,OAAA;YAAKsG,SAAS,EAAC,kBAAkB;YAAAC,QAAA,gBAC/BvG,OAAA;cAAAuG,QAAA,gBACEvG,OAAA;gBAAIsG,SAAS,EAAC,oBAAoB;gBAAAC,QAAA,GAC/B5C,CAAC,CAACE,IAAI,EAAC,UAAG,EAACtB,WAAW,CAACoB,CAAC,CAACG,SAAS,CAAC;cAAA;gBAAA0C,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAClC,CAAC,eAEL3G,OAAA;gBAAKsG,SAAS,EAAC,mBAAmB;gBAAAC,QAAA,gBAChCvG,OAAA;kBAAMsG,SAAS,EAAC,MAAM;kBAAAC,QAAA,EAAE5C,CAAC,CAACO;gBAAS;kBAAAsC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAO,CAAC,eAC3C3G,OAAA;kBAAMsG,SAAS,EAAC,MAAM;kBAAAC,QAAA,EAAE5C,CAAC,CAACuB;gBAAU;kBAAAsB,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAO,CAAC,eAC5C3G,OAAA;kBAAMsG,SAAS,EAAC,kBAAkB;kBAAAC,QAAA,GAAC,QAC3B,EAAC5C,CAAC,CAACwB,eAAe;gBAAA;kBAAAqB,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACpB,CAAC,eACP3G,OAAA;kBAAMsG,SAAS,EAAC,gBAAgB;kBAAAC,QAAA,EAC7B9D,cAAc,CAACkB,CAAC,CAACa,SAAS;gBAAC;kBAAAgC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACxB,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACJ,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH,CAAC,eAEN3G,OAAA;cAAMsG,SAAS,EAAE,aAAarD,SAAS,CAACU,CAAC,CAACI,aAAa,CAAC,EAAG;cAAAwC,QAAA,EACxD5C,CAAC,CAACI;YAAa;cAAAyC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACZ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACJ,CAAC,EAELhD,CAAC,CAAC2B,gBAAgB,iBACjBtF,OAAA;YAAGsG,SAAS,EAAC,iBAAiB;YAAAC,QAAA,gBAC5BvG,OAAA;cAAAuG,QAAA,EAAQ;YAAO;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,EAAC,GAAG,eAC5B3G,OAAA;cAAMsG,SAAS,EAAC,eAAe;cAAAC,QAAA,EAAE5C,CAAC,CAAC2B;YAAgB;cAAAkB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC1D,CACJ,eAGD3G,OAAA;YAAKsG,SAAS,EAAC,iBAAiB;YAAAC,QAAA,gBAC9BvG,OAAA;cACEsG,SAAS,EAAC,iBAAiB;cAC3BY,KAAK,EAAC,cAAc;cACpBnG,IAAI,EAAC,QAAQ;cACboG,OAAO,EAAEA,CAAA,KAAMzC,qBAAqB,CAACf,CAAC,CAAE;cAAA4C,QAAA,eAExCvG,OAAA,CAACN,UAAU;gBAAA8G,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACR,CAAC,eAET3G,OAAA;cACEsG,SAAS,EAAC,iBAAiB;cAC3BY,KAAK,EAAC,WAAW;cACjBnG,IAAI,EAAC,QAAQ;cACbsG,QAAQ,EAAE,CAAC1D,CAAC,CAAC+B,aAAc;cAC3ByB,OAAO,EAAEA,CAAA,KAAMf,aAAa,CAACzC,CAAC,CAAE;cAAA4C,QAAA,eAEhCvG,OAAA,CAACL,UAAU;gBAAA6G,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACR,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACN,CAAC;QAAA,GAnDEhD,CAAC,CAAC2D,GAAG;UAAAd,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAoDV,CACN;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACC,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,EAGLlF,QAAQ,IAAIE,kBAAkB,iBAC7B3B,OAAA;MAAKsG,SAAS,EAAC,uBAAuB;MAACa,OAAO,EAAEd,cAAe;MAAAE,QAAA,eAC7DvG,OAAA;QACEsG,SAAS,EAAC,qBAAqB;QAC/Ba,OAAO,EAAGhB,CAAC,IAAKA,CAAC,CAACoB,eAAe,CAAC,CAAE;QAAAhB,QAAA,gBAEpCvG,OAAA;UAAKsG,SAAS,EAAC,sBAAsB;UAAAC,QAAA,gBACnCvG,OAAA;YAAAuG,QAAA,gBACEvG,OAAA;cAAKsG,SAAS,EAAC,qBAAqB;cAAAC,QAAA,GACjC5E,kBAAkB,CAACkC,IAAI,EAAC,SAAE,EAAC,GAAG,EAC9BtB,WAAW,CAACZ,kBAAkB,CAACmC,SAAS,CAAC;YAAA;cAAA0C,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACvC,CAAC,eACN3G,OAAA;cAAKsG,SAAS,EAAC,iCAAiC;cAAAC,QAAA,EAC7C9D,cAAc,CAACd,kBAAkB,CAAC6C,SAAS;YAAC;cAAAgC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAC1C,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACH,CAAC,eAEN3G,OAAA;YACEsG,SAAS,EAAC,qBAAqB;YAC/BvF,IAAI,EAAC,QAAQ;YACboG,OAAO,EAAEd,cAAe;YACxBa,KAAK,EAAC,OAAO;YAAAX,QAAA,eAEbvG,OAAA,CAACH,OAAO;cAAA2G,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACL,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC,eAEN3G,OAAA;UAAKsG,SAAS,EAAC,oBAAoB;UAAAC,QAAA,EAChC5E,kBAAkB,CAAC+D,aAAa,gBAC/B1F,OAAA;YACE4G,GAAG,EAAE,yBAAyBjF,kBAAkB,CAAC+D,aAAa,EAAG;YACjEmB,GAAG,EAAC,eAAe;YACnBP,SAAS,EAAC;UAAoB;YAAAE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC/B,CAAC,gBAEF3G,OAAA;YAAKsG,SAAS,EAAC,2BAA2B;YAAAC,QAAA,EAAC;UAE3C;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK;QACN;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CACN,eAED3G,OAAA,CAACP,MAAM;MAAA+G,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACP,CAAC;AAEV,CAAC;AAACzG,EAAA,CA3YID,iBAAiB;AAAAuH,EAAA,GAAjBvH,iBAAiB;AA6YvB,eAAeA,iBAAiB;AAAC,IAAAuH,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}